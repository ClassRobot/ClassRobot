{% extends 'base.html' %} {% block main %}
<main id="app">
    <div class="header">
        <h3>机器人管理后台</h3>
        <div class="status-bar">
            <div class="wss-status" :class="{'wss-close': !wss_status}" v-text="wss_status? '已连接': '已断开'"></div>
        </div>
    </div>
    <div class="main">
        <div class="left-bar">
            <div class="tools">
                <div class="button" @click="login_form.display=true">添加账号</div>
                <div class="button" @click="updateList">刷新列表</div>
            </div>
            <div class="accordion" :class="{'down':display_card.bot}">
                <div class="button" @click="display_card.bot = !display_card.bot">已登录账号</div>
                <div class="cards" v-show="display_card.bot">
                    <div v-for="bot in bots" class="bot-card" @click="robotDetails(bot.user_id)">
                        <img :src="`http://q1.qlogo.cn/g?b=qq&nk=${bot.user_id}&s=100`">
                        <span class="info">
                            <div class="nickname" v-text="bot.nickname"></div>
                            <span v-text="bot.user_id"></span>
                        </span>
                        <div :class="selectRobot.user_id == bot.user_id? 'select-robot': 'select'" title="退出账号" @click="botStop(bot.user_id)"></div>
                    </div>
                </div>
            </div>
            <link rel="stylesheet/less" type="text/css" href="{{ static }}styles/styles.less" />
            <div class="accordion" :class="{'down':display_card.login}">
                <div class="button" @click="display_card.login = !display_card.login">未登录账号</div>
                <div class="cards" v-show="display_card.login">
                    <div class="login-card" v-for="user_id in bot_files" v-if="!checkBot(user_id)" @click="robotDetails(user_id)">
                        <img :src="`http://q1.qlogo.cn/g?b=qq&nk=${user_id}&s=100`">
                        <div class="info">
                            <span v-text="user_id"></span>
                        </div>
                        <div :class="selectRobot.user_id == user_id? 'select-robot': 'select'" title="登录" @click="loginBot(user_id)"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="view">
            <div class="nonebot-view">
                <template>
                <div class="system-state">
                    <div class="cpu">
                        <div class="bar">CPU状态</div>
                        <div class="state-view">
                            <div class="progress-pie-chart" :class="{'gt-50': cpu_percent > 50}">
                                <!--Pie Chart -->
                                <div class="ppc-progress">
                                    <div class="ppc-progress-fill" :style="{transform : 'rotate(' + 360 * cpu_percent / 100 + 'deg)'}"></div>
                                </div>
                                <div class="ppc-percents">
                                    <div class="pcc-percents-wrapper">
                                        <span><font v-text="cpu_percent"></font>%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="memory">
                        <div class="bar">内存状态</div>
                        <div class="state-view">
                            <table class="text">
                                <tr>
                                    <td>总空间</td>
                                    <td>已用空间</td>
                                    <td>可用空间</td>
                                </tr>
                                <tr>
                                    <td v-text="memory.total"></td>
                                    <td v-text="memory.used"></td>
                                    <td v-text="memory.free"></td>
                                </tr>
                            </table>
                            <div class="percent-bar">
                                <div class="percent" :style="{width: memory.percent}" v-text="memory.percent"></div>
                            </div>
                        </div>
                    </div>
                    <div class="disk">
                        <div class="bar">磁盘状态</div>
                        <div class="state-view">
                            <table class="text">
                                <tr>
                                    <td>总空间</td>
                                    <td>已用空间</td>
                                    <td>可用空间</td>
                                </tr>
                                <tr>
                                    <td v-text="disk.total"></td>
                                    <td v-text="disk.used"></td>
                                    <td v-text="disk.free"></td>
                                </tr>
                            </table>
                            <div class="percent-bar">
                                <div class="percent" :style="{width: disk.percent}" v-text="disk.percent"></div>
                            </div>
                        </div>
                    </div>
                </div>
                </template>
                <div class="system-logger">
                    <div class="bar">
                        NoneBot运行日志
                    </div>
                    <div class="logger-style" ref="systemLogger"></div>
                </div>
            </div>
            <div class="bot-view" v-show="selectRobot.user_id">
                <div class="quit" @click="robotDetails()">X</div>
                <div class="logger">
                    <div class="logger-bar">
                        <div class="logger-date">
                            <div class="date" :class="{'select': logger.date==date}" v-for="date in logger.date_list" v-text="date" @click="botLogger(selectRobot.user_id, date)"></div>
                        </div>
                        <div class="number">
                            <label for="number">条数</label>
                            <input type="number" id="number" class="logger-length" name="logger-length" id="logger-length" v-model="logger.length" min="1">
                        </div>
                        <div class="logger-update" @click="botLogger(selectRobot.user_id, logger.date, true)"></div>
                    </div>
                    <div class="logger-style" ref="botLogger" v-html="botLoggerText"></div>
                </div>
            </div>
            <div class="login-view" v-if="login_form.display">
                <div class="quit" @click="login_form.display=false">X</div>
                <div class="login-form">
                    <div class="input">
                        <label for="username">账号</label>
                        <input type="text" class="username" name="username" id="username" v-model="login_form.username" required>
                    </div>
                    <div class="input">
                        <label for="password">密码</label>
                        <input type="password" class="password" name="password" id="password" v-model="login_form.password">
                    </div>
                    <div class="input">
                        <button @click="loginBot(login_form.username, login_form.password)">登录</button>
                    </div>
                </div>
            </div>
            <div class="qrcode-view" v-if="qrcode">
                <div class="quit" @click="qrcode=null">X</div>
                <div class="qrcode">
                    <img class="qrcode-img" :src="'data:image/png;base64,' + qrcode.qrcode">
                    <!-- <img class="qrcode-img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACUAAAAlAQAAAADt5R2uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA20lEQVQImWP4DwIMEPKAzwEDeYb7If+m32e4mL+3JJ7hon91CJBMqJ4Sz3A/z7v8PsOB0NAAeYb/dxvt/zNcsvIRm8/w4+ipTfIMr3VzLe4zHJomPOs/w0/W+z33GY482Bdlz3Aq8cPn/wxX9tgtq2e4nvFM9T/D0VOyJvsZrpbbHrRnuLxA+el+hiPe+TPqGS5O+bItnuFz2bUl8xkezC5csZ/hist9RqBdhznu7Gc44H9Q9D/DfX8RGaB76oKB4he9ZvwGujNWPame4X4irwTQbU5ub+oZkHwEAImNcTK6z159AAAAAElFTkSuQmCC"> -->
                    <div class="qrcode-info">
                        <img class="logo" :src="`http://q1.qlogo.cn/g?b=qq&nk=${qrcode.user_id}&s=100`">
                        <div v-text="qrcode.user_id"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script src="{{ static }}scripts/wss.js"></script>
{% endblock main %}